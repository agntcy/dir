# Copyright AGNTCY Contributors (https://github.com/agntcy)
# SPDX-License-Identifier: Apache-2.0

# Optional StorageClass with topology constraints for Zot config PVC
# Only created when zot.configPvcStorageClass is defined
# Use this to ensure config PVC is created in the same AZ as data PVC
{{- if and .Values.zot.enabled .Values.zot.configPvcStorageClass }}
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: {{ .Values.zot.configPvcStorageClass.name }}
  labels:
    {{- include "chart.labels" . | nindent 4 }}
provisioner: {{ .Values.zot.configPvcStorageClass.provisioner | default "ebs.csi.aws.com" }}
parameters:
  {{- toYaml .Values.zot.configPvcStorageClass.parameters | nindent 2 }}
volumeBindingMode: {{ .Values.zot.configPvcStorageClass.volumeBindingMode | default "WaitForFirstConsumer" }}
allowVolumeExpansion: {{ .Values.zot.configPvcStorageClass.allowVolumeExpansion | default true }}
{{- if .Values.zot.configPvcStorageClass.allowedTopologies }}
allowedTopologies:
{{- toYaml .Values.zot.configPvcStorageClass.allowedTopologies | nindent 0 }}
{{- end }}
{{- end }}
