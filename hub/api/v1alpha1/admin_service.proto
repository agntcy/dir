syntax = "proto3";

package saas.v1alpha1;

option go_package = "github.com/cisco-eti/phoenix-saas-be/api/saas/v1alpha1";

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "buf/validate/validate.proto"; 
import "saas/v1alpha1/roles.proto";

message CreateTenantRequest {
  string name = 1 [
    (buf.validate.field).string.pattern = "^[a-z0-9_-]+$",
    (buf.validate.field).string.max_len = 100
  ];
}

message CreateTenantResponse {
  string id = 1;
  string name = 2;
}

message DeleteTenantRequest {
  string tenant_id = 1 [
    (buf.validate.field).string.uuid = true
  ];
}

message InviteUserRequest {
  string tenant_id = 1 [
    (buf.validate.field).string.uuid = true
  ];
  string username = 2 [
    (buf.validate.field).string.min_len = 1
  ];
  repeated ProductRole roles = 3 [
    (buf.validate.field).repeated = {
      unique: true,
      min_items: 1
      items: {
        enum: { in: [1, 2, 3] }
      }
    }
  ];
}

message InviteUserResponse {
  string tenant_id = 1;
  string username = 2;
  repeated ProductRole roles = 3;
}

message RemoveUserRequest {
  string tenant_id = 1 [
    (buf.validate.field).string.uuid = true
  ];
  string username = 2 [
    (buf.validate.field).string.min_len = 1
  ];
}

message UpdateUserRequest {
  string tenant_id = 1 [
    (buf.validate.field).string.uuid = true
  ];
  string username = 2 [
    (buf.validate.field).string.min_len = 1
  ];
  repeated ProductRole newRoles = 3 [
    (buf.validate.field).repeated = {
      unique: true,
      min_items: 1,
      items: {
        enum: { in: [1, 2, 3] }
      }
    }
  ];
}

message UpdateUserResponse {
  string tenant_id = 1;
  string username = 2;
  repeated string roles = 3;
}

service AdministrationService {
  rpc CreateTenant(CreateTenantRequest) returns (CreateTenantResponse) {
    option (google.api.http) = {
      post: "/v1alpha1/admin/tenants"
      body: "*"
    };
  }

  // Removed from our API for now just to make sure

  // rpc DeleteTenant(DeleteTenantRequest) returns (google.protobuf.Empty) {
  //   option (google.api.http) = {
  //     delete: "/v1alpha1/admin/tenants/{tenant_id}"
  //   };
  // }

  rpc InviteUser(InviteUserRequest) returns (InviteUserResponse) {
    option (google.api.http) = {
      post: "/v1alpha1/admin/tenants/{tenant_id}/invite"
      body: "*"
    };
  }

  rpc RemoveUser(RemoveUserRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      delete: "/v1alpha1/admin/tenants/{tenant_id}/users/{username}"
    };
  }

  rpc UpdateUser(UpdateUserRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      put: "/v1alpha1/admin/tenants/{tenant_id}/users"
      body: "*"
    };
  }
}